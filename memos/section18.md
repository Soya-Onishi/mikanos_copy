# ページング

## アドレス変換

### TODO

- ASLRについて調べる。どういう仕組みか、置き換え前の値はどのようなものなのかなど
- リンカが0x0020000や0x00400000にプログラムなどを配置する理由
- PAE(Physical Address Extension)について調べる
- LME(Long Mode Enable)について調べる
- みかん本のサンプルOSのリポジトリにPRを送る（内容はPR内容のセクションに記載）

### メモ

#### LongModeについて

OS-dev Wikiによると64bit向けのページングはCR3レジスタに入れるだけでなく、
他のコントロールレジスタに値を書き込むのはもちろん、
色々な作業が必要になる。

これがみかん本の方でできていないのか、Qemu内のUEFIアプリケーションが勝手にやってくれてるのか
どちらかは不明。（多分UEFIアプリケーションではやってくれないと思うが…）

#### MSRレジスタ

`ecx`レジスタにアドレスを入力し、`rdmsr`命令を実行することで、
下位をeaxレジスタ、上位をedxレジスタに格納する。
MSRレジスタに書き込む場合は`wrmsr`命令を用いる。

### PR内容

すでに修正済みまたは修正のPRが出ているなら対応不要

ELFのプログラムロード処理において、必要なページ数を計算する処理が`p_memsz`のみに依存している。
実際はロードのスタート位置によってもページ数が変化するため、
`(p_vaddr & 0xFFF) + p_memsz`に依存するのが良いと思われる。